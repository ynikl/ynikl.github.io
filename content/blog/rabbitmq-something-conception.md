---
title: "RabbitMQ 其他概念简单了解"
date: 2022-07-10T16:48:03+08:00
publishDate: 2022-07-10T16:48:03+08:00
draft: true
tags:
- rabbitmq
---

## 发送消息参数

- 参数 mandatory : 没有投递成功的消息, 会返回消息给生产者
- 参数 immediate : 如果队列当前没有消费者 -- 立即消费, 即返回者
- 备份交换器 : 被路由成功的消息, 可以设置发送往备份交换器

## TTL 

设置消息的过期时间, 可针对队列, 或者针对消息. 两者取其小
	针对队列, 当消息过期时, 从队列移除. 
	针对消息, 当投递给消费者时, 判断是否过期.
	

## 死信队列

当消息变成死信(dead message) 可以重新发送往另一个交互器 -- DLX

变成死信的原因:
- 消息被拒绝
- 过期
- 队列过长


## 延迟队列

RabbitMQ 本身不支持延迟队列, 但是可以通过死信队列 + TTL 组合实现


## 队列优先级

声明队列的时候课传入参数设置, 仅在消息堆积的情况下才有意义. 


## 持久化

声明队列时参数 `durable` 表示: 该队列的元数据持久化, 即(队列名称, 设置而已)

对数据持久化, 需要修改消息投递模式, 但是会影响RabbitMQ性能. 开启之后, 也不保证数据不丢失. 


## 消息确认

### 生产方:

确认消息已经被 Broker 正确接收

- 事务机制实现 (性能差, 略 QAQ)
- 发送方确认 ( publisher confirm) 
	
发送方确认

将 **信道** 设置成 confirm 模式, 之后 RabbitMQ 确认到消息会返回 *Basic.Ack*

### 消费方

- 消息拉模式
- 消息推模式

确认消息已经被接受, RabbitMQ 才能把当前消息从队列在清除

**channel.basicQos(int prefetchCount)** 
允许限制信道上消费者所能保持的最大未确认数量, 达到数量之后就不会再继续推送消息给消费者

## 参考
- [RabbitMQ 实战指南](https://book.douban.com/subject/27591386/)
